<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="description" content="Daily Activity Breakdown — minimal, accessible, and editable timetable with a clean donut chart."/>
<title>Daily Activity Breakdown — Minimal</title>

<!-- Roboto from Google Fonts (Material feel) -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
  /* ---------------- Theme & tokens (easy to tweak) ---------------- */
  :root{
    --bg: #FAFBFC;
    --surface: #FFFFFF;
    --muted: #6B7280;
    --text: #0F172A;
    --primary: #1E88E5;   /* Google-like blue */
    --accent: #00BFA5;    /* calm teal */
    --elev-1: 0 6px 18px rgba(16,24,40,0.06);
    --radius: 12px;
    --container: 980px;
    --gap: 20px;
    --chart-size: 420px;
    --palette: #3F51B5,#2196F3,#03A9F4,#00BCD4,#009688,#4CAF50,#8BC34A,#FFC107,#FF9800,#FF5722,#9C27B0,#E91E63,#607D8B,#795548,#9E9E9E;
  }

  /* dark-mode toggle respects user preference; app provides a light default (Google favors light) */
  @media (prefers-color-scheme: dark){
    :root{
      --bg: #0B0F13;
      --surface: #0F1720;
      --muted: #9CA3AF;
      --text: #E6EEF6;
      --elev-1: 0 8px 24px rgba(0,0,0,0.6);
    }
  }

  @media (prefers-reduced-motion: reduce){
    :root { --reduced-motion: 1; }
  }

  /* ---------------- Base layout ---------------- */
  html,body{ height:100%; margin:0; font-family: Roboto, system-ui, -apple-system, "Segoe UI", Arial; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

  .app{
    max-width: var(--container);
    margin: 28px auto;
    padding: 24px;
  }

  header.appbar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:18px;
  }

  .brand{
    display:flex;
    align-items:center;
    gap:14px;
  }
  .logo{
    width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));
    display:inline-flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:18px;box-shadow:var(--elev-1);
  }
  h1{ margin:0; font-size:1.15rem; font-weight:500; letter-spacing: -0.01em; }
  .subtitle{ margin-top:2px; color:var(--muted); font-size:0.92rem; }

  /* main layout: center stage */
  main.layout{
    display:grid;
    grid-template-columns: 1fr 300px;
    gap:24px;
    align-items:start;
  }
  @media (max-width:980px){ main.layout{ grid-template-columns: 1fr; } }

  /* central card */
  .card{
    background:var(--surface);
    border-radius:var(--radius);
    padding:20px;
    box-shadow:var(--elev-1);
  }

  /* minimal chart area (donut) */
  .chart-area{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    padding:12px;
  }

  /* Donut container */
  .donut {
    width: min(100%, var(--chart-size));
    max-width: var(--chart-size);
    aspect-ratio: 1 / 1;
    display:block;
  }

  /* center label */
  .center-label{
    position:relative;
    margin-top: -calc(var(--chart-size) * 0.6);
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
  }
  .center-box{
    background:transparent;
    color:var(--text);
    text-align:center;
    pointer-events:none;
    width:170px;
  }
  .center-box .total{ font-size:1.25rem; font-weight:600; }
  .center-box .muted{ color:var(--muted); font-size:0.92rem; margin-top:6px; }

  /* compact legend on right */
  .side{
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .legend{
    display:flex;
    flex-direction:column;
    gap:8px;
    max-height:48vh;
    overflow:auto;
    padding:6px;
  }
  .legend-item{ display:flex; gap:12px; align-items:center; padding:8px; border-radius:10px; cursor:pointer; }
  .legend-item:focus, .legend-item[aria-pressed="true"]{ outline:3px solid rgba(30,136,229,0.12); background: rgba(30,136,229,0.03); }
  .swatch{ width:16px; height:16px; border-radius:4px; flex-shrink:0; }

  /* FAB: minimal export/settings */
  .fab{
    position: fixed;
    right: 22px;
    bottom: 22px;
    background:var(--primary);
    color:#fff;
    width:56px;height:56px;border-radius:14px;
    display:flex;align-items:center;justify-content:center;
    box-shadow: 0 10px 30px rgba(16,24,40,0.18);
    cursor:pointer;
    border:none;
    font-size:20px;
  }
  .fab:focus{ outline:3px solid rgba(30,136,229,0.18); outline-offset:4px; }

  /* minimal sheet slide (for settings / table) */
  .sheet{
    position: fixed;
    right: 22px;
    bottom: 90px;
    width: 340px;
    max-width: calc(100% - 48px);
    border-radius:12px;
    background:var(--surface);
    box-shadow:var(--elev-1);
    padding:12px;
    transform: translateY(8px);
    transition: opacity .22s ease, transform .22s ease;
    opacity:0;
    pointer-events:none;
  }
  .sheet.open{ opacity:1; pointer-events:auto; transform: translateY(0); }

  .sheet h4{ margin:0 0 8px 0; font-size:1rem; }
  .controls-row{ display:flex; gap:8px; align-items:center; margin-bottom:8px; }
  .btn{ border:0; background:transparent; padding:8px 10px; border-radius:8px; cursor:pointer; color:var(--text); font-weight:500; }
  .btn.ghost{ border:1px solid rgba(16,24,40,0.06); background:transparent; }
  .btn.primary{ background:var(--primary); color:white; }
  .btn:focus{ outline:3px solid rgba(30,136,229,0.12); outline-offset:2px; }

  /* table (collapsed by default inside sheet, minimal) */
  table.min-table{ width:100%; border-collapse:collapse; font-size:0.93rem; }
  table.min-table th, table.min-table td{ padding:8px 6px; text-align:left; color:var(--text); border-bottom:1px solid rgba(16,24,40,0.04); }
  input.small{ width:72px; padding:6px 8px; border-radius:8px; border:1px solid rgba(16,24,40,0.06); background:transparent; color:var(--text); }

  /* focus visibility improvements */
  :focus{ scroll-margin-top:120px; }

  /* small helper */
  .muted{ color:var(--muted); font-size:0.92rem; }
  .hidden{ display:none!important; }

  /* reduce motion */
  @media (prefers-reduced-motion: reduce){
    .sheet, .donut, .legend-item, .fab { transition: none !important; }
  }
</style>
</head>
<body>
  <div class="app" id="app">
    <header class="appbar" role="banner">
      <div class="brand" aria-hidden="false">
        <div class="logo" aria-hidden="true">DA</div>
        <div>
          <h1>Daily Activity</h1>
          <div class="subtitle">Clean timetable & visualizer — minimal and accessible</div>
        </div>
      </div>

      <div aria-hidden="false">
        <!-- small, visible useful action: toggle table (secondary) -->
        <button id="open-sheet" class="btn ghost" aria-expanded="false" aria-controls="sheet">Table & Export</button>
      </div>
    </header>

    <main class="layout" id="main">
      <!-- Centered main card: donut + center label -->
      <section class="card chart-area" aria-labelledby="chart-heading" role="main">
        <h2 id="chart-heading" style="margin:0;font-weight:500;font-size:1rem">Your day — donut overview</h2>

        <!-- SVG donut -->
        <div aria-hidden="false" style="position:relative;display:flex;align-items:center;justify-content:center;">
          <svg id="svgDonut" class="donut" viewBox="0 0 420 420" role="img" aria-labelledby="chart-title" tabindex="0"></svg>
          <!-- center label overlay (minimal) -->
          <div class="center-label" aria-hidden="false">
            <div class="center-box" id="centerBox">
              <div class="total" id="totalHours">0 hrs</div>
              <div class="muted" id="totalLabel">Total scheduled</div>
            </div>
          </div>
        </div>

        <p class="muted" style="margin-top:8px;">Click any legend item or table row to highlight slices. Edits auto-save to your browser (localStorage).</p>
      </section>

      <!-- Side: concise legend inside card -->
      <aside class="side">
        <div class="card" aria-labelledby="legend-heading">
          <h3 id="legend-heading" style="margin:0 0 8px 0;font-size:1rem;">Legend</h3>
          <div id="legend" class="legend" role="list" aria-label="Activities legend">
            <!-- JS populates legend items -->
          </div>

          <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
            <button id="exportPNG" class="btn">Export PNG</button>
            <button id="exportCSV" class="btn">Export CSV</button>
          </div>
        </div>

        <div class="card" style="padding:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <div style="font-weight:600">Quick info</div>
              <div class="muted">Tip: keep high-priority tasks early in the day.</div>
            </div>
            <div style="font-size:0.85rem;color:var(--muted)">Auto-save</div>
          </div>
        </div>
      </aside>
    </main>

    <footer style="margin-top:18px;text-align:center;color:var(--muted);font-size:0.9rem;">
      Minimal UI • accessible • local-only
    </footer>
  </div>

  <!-- Floating Action Button opens sheet -->
  <button id="fab" class="fab" aria-label="Open table and settings">⚙️</button>

  <!-- Sheet (table + controls) -->
  <aside id="sheet" class="sheet" role="dialog" aria-modal="false" aria-labelledby="sheetTitle" hidden>
    <h4 id="sheetTitle">Table & exports</h4>
    <div class="controls-row" role="toolbar" aria-label="Sheet controls">
      <button id="addRow" class="btn">Add</button>
      <button id="reset" class="btn">Reset</button>
      <div style="flex:1"></div>
      <button id="closeSheet" class="btn">Close</button>
    </div>

    <!-- Minimal editable table -->
    <div style="max-height:50vh; overflow:auto; margin-top:8px;">
      <table class="min-table" id="editTable" aria-describedby="sheetTitle">
        <thead><tr><th>Activity</th><th style="width:80px">Hours</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div style="display:flex;gap:8px;margin-top:10px;justify-content:flex-end;">
      <button id="sheetExportPNG" class="btn ghost">Export PNG</button>
      <button id="sheetExportCSV" class="btn ghost">Export CSV</button>
    </div>
  </aside>

<script>
/* ---------------- Single source of truth ---------------- */
const DEFAULT = [
  { label: 'Morning Routine (5:30-6:00 AM)', hours: 0.5 },
  { label: 'Meditation (6:00-6:30 AM)', hours: 0.5 },
  { label: 'Light Exercise (6:30-7:00 AM)', hours: 0.5 },
  { label: 'Study Session 1 (7:00-8:30 AM)', hours: 1.5 },
  { label: 'Breakfast & News (8:30-9:00 AM)', hours: 0.5 },
  { label: 'Study Session 2 (9:00 AM - 12:00 PM)', hours: 3 },
  { label: 'Short Break (12:00-12:30 PM)', hours: 0.5 },
  { label: 'Mock Test (12:30-2:30 PM)', hours: 2 },
  { label: 'Lunch & Relax (2:30-3:30 PM)', hours: 1 },
  { label: 'Study Session 3 (3:30-5:30 PM)', hours: 2 },
  { label: 'Break (5:30-6:00 PM)', hours: 0.5 },
  { label: 'Study Session 4 (6:00-7:30 PM)', hours: 1.5 },
  { label: 'Dinner & Talk (7:30-8:00 PM)', hours: 0.5 },
  { label: 'Light Reading (8:00-9:30 PM)', hours: 1.5 },
  { label: 'Planning (9:30-10:00 PM)', hours: 0.5 },
  { label: 'Sleep Prep (10:00-10:30 PM)', hours: 0.5 },
  { label: 'Sleep (10:30 PM - 5:30 AM)', hours: 7 }
];

const KEY = 'da-minimal-v1';
let data = load();

function load(){
  try{
    const raw = localStorage.getItem(KEY);
    if(!raw) return structuredClone(DEFAULT);
    const parsed = JSON.parse(raw);
    if(!Array.isArray(parsed) || parsed.length===0) return structuredClone(DEFAULT);
    parsed.forEach(p => { p.hours = Number(p.hours)||0; p.label = String(p.label||''); });
    return parsed;
  }catch(e){
    console.warn('load failed', e);
    return structuredClone(DEFAULT);
  }
}

function save(){
  try{ localStorage.setItem(KEY, JSON.stringify(data)); announce('Saved locally'); }catch(e){ console.warn('save failed', e); }
}

/* --------- Utilities: colors, arc math, svg drawing ---------- */
const svg = document.getElementById('svgDonut');
const legendEl = document.getElementById('legend');
const totalHoursEl = document.getElementById('totalHours');
const centerLabelEl = document.getElementById('totalLabel');
const palette = getComputedStyle(document.documentElement).getPropertyValue('--palette') || getComputedStyle(document.documentElement).getPropertyValue('--palette');
const colors = (getComputedStyle(document.documentElement).getPropertyValue('--palette') || getComputedStyle(document.documentElement).getPropertyValue('--palette') || '').split(',').map(s => s.trim()).filter(Boolean);
function getColor(i){ return colors[i % colors.length] || (['#3F51B5','#2196F3','#00BCD4','#009688','#4CAF50','#FF9800'][i%6]); }

function deg2rad(d){ return d * Math.PI / 180; }
function polar(cx, cy, r, a){ return { x: cx + r * Math.cos(deg2rad(a-90)), y: cy + r * Math.sin(deg2rad(a-90)) }; }

function arcPath(cx, cy, r, start, end){
  const p1 = polar(cx,cy,r,start);
  const p2 = polar(cx,cy,r,end);
  const large = (end - start) <= 180 ? 0 : 1;
  return `M ${cx} ${cy} L ${p1.x} ${p1.y} A ${r} ${r} 0 ${large} 0 ${p2.x} ${p2.y} Z`;
}

/* ---------- render functions ---------- */
let selected = null;

function render(){
  renderLegend();
  renderSvg();
  renderCenter();
  renderTableInSheet();
  save();
}

function renderCenter(){
  const total = data.reduce((s,d)=>s+d.hours,0) || 0;
  const t = Math.round(total * 10)/10;
  totalHoursEl.textContent = `${t} hrs`;
  centerLabelEl.textContent = 'Total scheduled';
}

function renderLegend(){
  legendEl.innerHTML = '';
  data.forEach((d,i) => {
    const item = document.createElement('div');
    item.className = 'legend-item';
    item.role = 'button';
    item.tabIndex = 0;
    item.dataset.index = i;
    item.setAttribute('aria-pressed', String(selected===i));
    const sw = document.createElement('span'); sw.className='swatch'; sw.style.backgroundColor = getColor(i);
    const txt = document.createElement('div'); txt.style.flex='1'; txt.innerHTML = `<div style="font-weight:600">${escapeHtml(d.label.replace(/\s*\(.*\)$/,''))}</div><div class="muted" style="margin-top:4px">${d.hours} hrs</div>`;
    item.appendChild(sw); item.appendChild(txt);
    item.addEventListener('click', ()=> select(i));
    item.addEventListener('keydown', (e)=> { if(e.key==='Enter'||e.key===' ') { e.preventDefault(); select(i); }});
    item.addEventListener('mouseenter', ()=> hoverSlice(i));
    item.addEventListener('mouseleave', ()=> renderSvg());
    legendEl.appendChild(item);
  });
}

/* svg donut drawing */
function renderSvg(){
  while(svg.firstChild) svg.removeChild(svg.firstChild);
  const size = 420;
  svg.setAttribute('viewBox', `0 0 ${size} ${size}`);
  svg.setAttribute('aria-labelledby', 'chart-heading');
  svg.setAttribute('role','img');

  const cx = size/2, cy = size/2, r = Math.min(cx,cy) - 10;
  const innerR = r * 0.55;

  const total = data.reduce((s,d)=>s+d.hours,0) || 1;
  let angle = 0;

  data.forEach((d,i)=>{
    const sweep = (d.hours/total) * 360;
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    const start = angle, end = angle + sweep;
    path.setAttribute('d', arcPath(cx,cy,r, start, end));
    path.setAttribute('fill', getColor(i));
    path.setAttribute('data-index', i);
    path.setAttribute('aria-label', `${d.label}, ${d.hours} hours`);
    path.style.transition = 'transform .28s ease';
    if (typeof document !== 'undefined' && window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) path.style.transition = 'none';

    // selection visual slight scale
    if (selected === i){
      const scale = 1.03;
      const tx = cx - cx*scale;
      const ty = cy - cy*scale;
      path.setAttribute('transform', `scale(${scale}) translate(${tx}, ${ty})`);
      path.setAttribute('stroke', '#00000020');
      path.setAttribute('stroke-width', '1.2');
    }

    path.addEventListener('click', ()=> select(i));
    path.addEventListener('mouseenter', ()=> hoverLegend(i));
    svg.appendChild(path);

    // optional small label for big slices
    if (sweep > 24){
      const mid = angle + sweep/2;
      const p = polar(cx,cy, r*0.7, mid);
      const text = document.createElementNS('http://www.w3.org/2000/svg','text');
      text.setAttribute('x', p.x);
      text.setAttribute('y', p.y);
      text.setAttribute('fill', '#fff');
      text.setAttribute('font-size','12');
      text.setAttribute('text-anchor','middle');
      text.setAttribute('dominant-baseline','central');
      text.textContent = `${Math.round((d.hours/total)*100)}%`;
      svg.appendChild(text);
    }

    angle += sweep;
  });

  // inner circle to create donut
  const inner = document.createElementNS('http://www.w3.org/2000/svg','circle');
  inner.setAttribute('cx', cx); inner.setAttribute('cy', cy); inner.setAttribute('r', innerR);
  inner.setAttribute('fill', getComputedStyle(document.documentElement).getPropertyValue('--surface').trim() || '#fff');
  svg.appendChild(inner);

  // keyboard navigation: left/right cycles selection
  svg.onkeydown = (e)=>{
    if (!['ArrowLeft','ArrowRight','ArrowUp','ArrowDown','Home','End'].includes(e.key)) return;
    e.preventDefault();
    const n = data.length;
    let idx = selected === null ? 0 : selected;
    if (e.key === 'ArrowLeft' || e.key==='ArrowUp') idx = (idx - 1 + n) % n;
    if (e.key === 'ArrowRight' || e.key==='ArrowDown') idx = (idx + 1) % n;
    if (e.key === 'Home') idx = 0;
    if (e.key === 'End') idx = n -1;
    select(idx);
  };
  svg.tabIndex = 0;
}

/* hover/interaction helpers */
function select(i){
  selected = i;
  render(); announce(`${data[i].label}, ${data[i].hours} hours selected.`);
}

function hoverSlice(i){ selected = i; renderSvg(); }
function hoverLegend(i){ /* keep shallow: temporary highlight */ renderSvg(); }

/* ---------- sheet (table) rendering & editing ---------- */
const sheet = document.getElementById('sheet');
const sheetBody = document.querySelector('#editTable tbody');
const openSheetBtn = document.getElementById('open-sheet');
const fab = document.getElementById('fab');

function renderTableInSheet(){
  sheetBody.innerHTML = '';
  data.forEach((d,i) => {
    const tr = document.createElement('tr');
    // label
    const tdLabel = document.createElement('td');
    const inLabel = document.createElement('input');
    inLabel.value = d.label;
    inLabel.className = 'small';
    inLabel.addEventListener('change', (e)=>{
      data[i].label = e.target.value || 'Untitled';
      save(); render();
    });
    tdLabel.appendChild(inLabel);
    tr.appendChild(tdLabel);

    // hours
    const tdHours = document.createElement('td');
    const inH = document.createElement('input');
    inH.type = 'number';
    inH.step = '0.25';
    inH.min = '0';
    inH.value = d.hours;
    inH.className = 'small';
    inH.addEventListener('change', (e)=>{
      let v = Number(e.target.value); if(Number.isNaN(v) || v < 0) v = 0;
      data[i].hours = v; save(); render();
    });
    tdHours.appendChild(inH);
    tr.appendChild(tdHours);

    // actions: up/down/delete
    const tdAct = document.createElement('td');
    tdAct.style.textAlign = 'right';
    const up = document.createElement('button'); up.className='btn'; up.textContent='↑'; up.title='Move up';
    up.addEventListener('click', ()=> move(i, -1));
    const down = document.createElement('button'); down.className='btn'; down.textContent='↓'; down.title='Move down';
    down.addEventListener('click', ()=> move(i, +1));
    const del = document.createElement('button'); del.className='btn'; del.textContent='Delete'; del.title='Remove';
    del.addEventListener('click', ()=> { if(confirm('Remove this activity?')) { data.splice(i,1); save(); render(); }});
    tdAct.appendChild(up); tdAct.appendChild(down); tdAct.appendChild(del);
    tr.appendChild(tdAct);

    tr.addEventListener('click', ()=> select(i));
    sheetBody.appendChild(tr);
  });
}

/* move item */
function move(index, delta){
  const to = index + delta;
  if (to < 0 || to >= data.length) return;
  const [it] = data.splice(index,1);
  data.splice(to,0,it);
  save(); render();
}

/* add row */
document.getElementById('addRow').addEventListener('click', ()=>{
  data.push({ label: 'New Activity', hours: 0.5 });
  save(); render();
});

/* reset */
document.getElementById('reset').add
