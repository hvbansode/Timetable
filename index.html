<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Chronos | Material Design</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />

  <style>
    /* --- MATERIAL DESIGN 3 TOKENS --- */
    :root {
      /* Light Theme Default */
      --md-sys-color-primary: #006495;
      --md-sys-color-on-primary: #ffffff;
      --md-sys-color-primary-container: #cbebff;
      --md-sys-color-on-primary-container: #001f31;
      
      --md-sys-color-background: #fcfcff;
      --md-sys-color-surface: #fcfcff;
      --md-sys-color-surface-variant: #dee3ea;
      --md-sys-color-on-surface: #1a1c1e;
      --md-sys-color-on-surface-variant: #41474d;
      
      --md-sys-color-outline: #71787e;
      --md-sys-color-outline-variant: #c1c7ce;

      /* Task Colors (Tonal) */
      --color-work: #006495;
      --color-meeting: #6b52a3;
      --color-health: #006d3a;
      --color-admin: #8d4f00;
      --color-rest: #5d5f5f;
      --color-delete: #ba1a1a;

      --font-family: 'Roboto', sans-serif;
      --elevation-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
      --elevation-3: 0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --md-sys-color-primary: #8cd4ff;
        --md-sys-color-on-primary: #003450;
        --md-sys-color-primary-container: #004b72;
        --md-sys-color-on-primary-container: #cbebff;
        
        --md-sys-color-background: #1a1c1e;
        --md-sys-color-surface: #1a1c1e;
        --md-sys-color-surface-variant: #41474d;
        --md-sys-color-on-surface: #e2e2e6;
        --md-sys-color-on-surface-variant: #c1c7ce;
        
        --md-sys-color-outline: #8b9198;
        --md-sys-color-outline-variant: #41474d;

        --color-work: #8cd4ff;
        --color-meeting: #d5bbff;
        --color-health: #6ddfa7;
        --color-admin: #ffb870;
        --color-rest: #c7c7c7;
        --color-delete: #ffb4ab;
        
        --elevation-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.5);
      }
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
    
    body {
      margin: 0; height: 100vh; overflow: hidden;
      background-color: var(--md-sys-color-background);
      color: var(--md-sys-color-on-surface);
      font-family: var(--font-family);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }

    /* --- APP CONTAINER --- */
    .app-bar {
      position: fixed; top: 0; width: 100%; height: 64px;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px; font-weight: 400; letter-spacing: -0.5px;
      color: var(--md-sys-color-on-surface);
      background: var(--md-sys-color-surface);
      z-index: 10;
    }

    .stage { position: relative; width: min(90vw, 600px); height: min(90vw, 600px); margin-top: -40px; }

    /* --- SVG CHART --- */
    svg { overflow: visible; }
    
    /* The Track */
    .track-bg { 
      fill: none; 
      stroke: var(--md-sys-color-surface-variant); 
      stroke-width: 40; 
      opacity: 0.3;
    }

    /* Segments */
    path.segment {
      fill: none; stroke-width: 40;
      stroke-linecap: round; /* Rounded ends = Material Style */
      transition: stroke-width 0.2s cubic-bezier(0.2, 0, 0, 1), filter 0.2s;
      cursor: pointer;
    }
    path.segment:hover { 
      stroke-width: 48; /* Slight grow on hover */
      filter: drop-shadow(0 4px 4px rgba(0,0,0,0.2));
    }

    /* Draft Wedge */
    path.draft {
      fill: none; stroke: var(--md-sys-color-primary); stroke-width: 40;
      opacity: 0.5; stroke-linecap: round; pointer-events: none;
      stroke-dasharray: 10 10; /* Dashed to indicate "Pending" */
    }

    /* Clock Ticks */
    line.tick { stroke: var(--md-sys-color-outline-variant); stroke-linecap: round; }
    line.tick.major { stroke: var(--md-sys-color-outline); stroke-width: 2; }

    /* Current Time Indicator */
    #nowHand {
      fill: var(--md-sys-color-primary);
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
    }

    /* --- CENTRAL HUD (Information Card) --- */
    .hub {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 200px; height: 200px; border-radius: 50%;
      background: var(--md-sys-color-surface);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      box-shadow: var(--elevation-2);
      z-index: 20; pointer-events: none;
      transition: transform 0.2s cubic-bezier(0.2, 0, 0, 1);
    }
    .hub.active { transform: translate(-50%, -50%) scale(1.05); box-shadow: var(--elevation-3); }

    .hud-overline { font-size: 12px; color: var(--md-sys-color-on-surface-variant); font-weight: 500; letter-spacing: 0.5px; text-transform: uppercase; }
    .hud-time { font-size: 48px; font-weight: 400; color: var(--md-sys-color-on-surface); line-height: 1.1; }
    .hud-sub { font-size: 14px; color: var(--md-sys-color-primary); font-weight: 500; margin-top: 4px; }

    /* --- BOTTOM SHEET (Selection UI) --- */
    .sheet-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 90;
      opacity: 0; pointer-events: none; transition: opacity 0.2s;
    }
    .sheet-overlay.open { opacity: 1; pointer-events: auto; }

    .bottom-sheet {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--md-sys-color-surface);
      border-radius: 28px 28px 0 0; /* Material Shape */
      padding: 24px; padding-bottom: 48px;
      transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1);
      z-index: 100;
      display: flex; flex-direction: column; gap: 16px;
      max-width: 600px; margin: 0 auto;
      box-shadow: var(--elevation-3);
    }
    .sheet-overlay.open .bottom-sheet { transform: translateY(0); }

    .sheet-header { font-size: 16px; font-weight: 500; color: var(--md-sys-color-on-surface); text-align: center; margin-bottom: 8px; }

    .chip-grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
    }

    .action-chip {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 20px;
      background: var(--md-sys-color-surface-variant);
      color: var(--md-sys-color-on-surface-variant);
      border-radius: 16px; cursor: pointer;
      transition: 0.2s;
      font-size: 14px; font-weight: 500;
    }
    .action-chip:hover { background: var(--md-sys-color-outline-variant); }
    .action-chip .icon { font-size: 20px; }
    
    /* Special Delete Chip */
    .action-chip.delete { background: #ffdad6; color: #410002; grid-column: span 2; justify-content: center; }
    @media (prefers-color-scheme: dark) { .action-chip.delete { background: #93000a; color: #ffdad6; } }

    /* --- FAB / Hint --- */
    .hint {
      position: fixed; bottom: 24px; 
      background: var(--md-sys-color-primary-container);
      color: var(--md-sys-color-on-primary-container);
      padding: 12px 24px; border-radius: 100px;
      font-size: 14px; font-weight: 500;
      box-shadow: var(--elevation-2);
      pointer-events: none; opacity: 0.9;
    }
  </style>
</head>
<body>

  <div class="app-bar">Schedule</div>

  <div class="stage" id="stage">
    <svg id="chart" viewBox="0 0 700 700">
      <circle cx="350" cy="350" r="240" class="track-bg" />
      
      <g id="segments"></g>
      
      <path id="draftWedge" class="draft" d="" style="display:none" />

      <g id="ticks"></g>
      
      <path id="nowHand" d="M 350 80 L 340 60 L 360 60 Z" />
    </svg>

    <div class="hub" id="hub">
      <div class="hud-overline">Current Time</div>
      <div class="hud-time" id="hudMain">00:00</div>
      <div class="hud-sub" id="hudSub"></div>
    </div>
  </div>

  <div class="sheet-overlay" id="sheetOverlay" onclick="App.cancelDraft()">
    <div class="bottom-sheet" onclick="event.stopPropagation()">
      <div class="sheet-header">Select Activity</div>
      <div class="chip-grid" id="chipGrid">
        </div>
    </div>
  </div>

  <div class="hint">Drag on track to plan</div>

<script>
/* --- MATERIAL APP ENGINE --- */
window.App = (() => {
  const S = {
    cx: 350, cy: 350, r: 240,
    // Pre-populated data
    tasks: [
      { id: 1, label: 'Deep Work', start: 540, end: 690, color: 'var(--color-work)', icon: 'psychology' }, // 09:00
      { id: 2, label: 'Lunch', start: 720, end: 780, color: 'var(--color-health)', icon: 'restaurant' }    // 12:00
    ],
    draft: null,
    isDragging: false,
    editingId: null
  };

  const $ = id => document.getElementById(id);
  
  // Helper: Minutes <-> Degrees
  const toDeg = m => (m/1440)*360;
  const toRad = d => (d-90) * Math.PI/180;

  // Calculate coordinates for SVG paths
  const getCoords = (deg, rad) => ({
    x: S.cx + rad * Math.cos(toRad(deg)),
    y: S.cx + rad * Math.sin(toRad(deg))
  });

  // Create SVG Arc Path string
  // Note: Using stroke-dasharray or simple arcs for Material look, but keeping path logic for precision
  const drawArc = (startM, endM, radius) => {
    const sDeg = toDeg(startM);
    const eDeg = toDeg(endM);
    const large = (eDeg - sDeg) > 180 ? 1 : 0;
    const p1 = getCoords(sDeg, radius);
    const p2 = getCoords(eDeg, radius);
    // Move to start, Arc to end. We use Stroke for thickness, not fill.
    return `M ${p1.x} ${p1.y} A ${radius} ${radius} 0 ${large} 1 ${p2.x} ${p2.y}`;
  };

  const getMinutesFromXY = (x, y) => {
    const rect = $('chart').getBoundingClientRect();
    // normalize coordinates relative to SVG viewbox (700x700)
    const scaleX = 700 / rect.width;
    const scaleY = 700 / rect.height;
    const svgX = (x - rect.left) * scaleX;
    const svgY = (y - rect.top) * scaleY;

    let angle = Math.atan2(svgY - S.cy, svgX - S.cx) * 180 / Math.PI + 90;
    if (angle < 0) angle += 360;
    
    // Snap to 15 mins (3.75 degrees)
    const snapped = Math.round(angle / 3.75) * 3.75;
    return Math.round((snapped / 360) * 1440) % 1440;
  };

  // --- INITIALIZATION ---
  const init = () => {
    drawTicks();
    render();
    setInterval(updateClock, 1000);
    setupInteractions();
    buildBottomSheet();
    updateClock();
  };

  const drawTicks = () => {
    const g = $('ticks');
    for (let i=0; i<24; i++) {
      const deg = (i/24)*360;
      const rStart = i%6===0 ? S.r - 30 : S.r - 15; // Length of tick
      const rEnd = S.r + 30;
      const p1 = getCoords(deg, rStart);
      const p2 = getCoords(deg, rEnd);
      
      const l = document.createElementNS('http://www.w3.org/2000/svg','line');
      l.setAttribute('x1',p1.x); l.setAttribute('y1',p1.y); 
      l.setAttribute('x2',p2.x); l.setAttribute('y2',p2.y);
      l.setAttribute('class', i%6===0 ? 'tick major' : 'tick');
      g.append(l);
    }
  };

  // --- RENDER LOOP ---
  const render = () => {
    const g = $('segments'); g.innerHTML = '';
    S.tasks.sort((a,b)=>a.start-b.start).forEach(t => {
      const p = document.createElementNS('http://www.w3.org/2000/svg','path');
      // Draw arc at radius
      p.setAttribute('d', drawArc(t.start, t.end, S.r));
      p.setAttribute('class', 'segment');
      p.setAttribute('stroke', t.color);
      
      // Interactions
      p.onmousedown = (e) => { e.stopPropagation(); openSheet(t); };
      p.onmouseenter = () => updateHudInfo(t.label, `${formatTime(t.start)} - ${formatTime(t.end)}`);
      p.onmouseleave = resetHud;
      g.append(p);
    });
  };

  // --- INPUT HANDLING ---
  const setupInteractions = () => {
    const svg = $('chart');
    
    svg.onmousedown = (e) => {
      if(e.target.classList.contains('segment')) return; // Edit mode handled by segment click
      
      S.isDragging = true;
      const m = getMinutesFromXY(e.clientX, e.clientY);
      
      S.draft = { start: m, end: m + 15 }; 
      $('draftWedge').style.display = 'block';
      $('hub').classList.add('active');
      updateDraftVisual();
    };

    window.onmousemove = (e) => {
      if(!S.isDragging) return;
      const currentM = getMinutesFromXY(e.clientX, e.clientY);
      
      // Basic clamp logic for demo
      if (Math.abs(currentM - S.draft.start) < 720) { // prevent wrapping weirdness
         S.draft.end = currentM;
         // Ensure minimum 15 mins
         if(S.draft.end <= S.draft.start) S.draft.end = S.draft.start + 15;
         updateDraftVisual();
      }
    };

    window.onmouseup = () => {
      if(S.isDragging) {
        S.isDragging = false;
        $('hub').classList.remove('active');
        openSheet(); // Open selection menu
      }
    };
  };

  const updateDraftVisual = () => {
    $('draftWedge').setAttribute('d', drawArc(S.draft.start, S.draft.end, S.r));
    
    const dur = S.draft.end - S.draft.start;
    const h = Math.floor(dur/60); const m = dur%60;
    $('hudMain').innerText = `${h}h ${m}m`;
    $('hudSub').innerText = "Release to set";
    $('hudSub').style.color = 'var(--md-sys-color-primary)';
  };

  // --- BOTTOM SHEET (UI) ---
  const activityTypes = [
    { l: 'Deep Work', c: 'var(--color-work)', i: 'psychology' },
    { l: 'Meeting', c: 'var(--color-meeting)', i: 'groups' },
    { l: 'Health', c: 'var(--color-health)', i: 'fitness_center' },
    { l: 'Admin', c: 'var(--color-admin)', i: 'folder' },
    { l: 'Rest', c: 'var(--color-rest)', i: 'coffee' }
  ];

  const buildBottomSheet = () => {
    const grid = $('chipGrid');
    // Regular Actions
    activityTypes.forEach(type => {
      const el = document.createElement('div');
      el.className = 'action-chip';
      el.innerHTML = `<span class="material-symbols-rounded icon" style="color:${type.c}">${type.i}</span> ${type.l}`;
      el.onclick = () => confirmSelection(type);
      grid.append(el);
    });

    // Delete Action (Only visible when editing)
    const del = document.createElement('div');
    del.className = 'action-chip delete';
    del.id = 'btnDelete';
    del.innerHTML = `<span class="material-symbols-rounded icon">delete</span> Remove Block`;
    del.onclick = () => {
      S.tasks = S.tasks.filter(t => t.id !== S.editingId);
      closeSheet();
    };
    grid.append(del);
  };

  const openSheet = (taskToEdit = null) => {
    const sheet = $('sheetOverlay');
    const title = sheet.querySelector('.sheet-header');
    const btnDelete = $('btnDelete');

    if (taskToEdit) {
      S.editingId = taskToEdit.id;
      title.innerText = "Edit Block";
      btnDelete.style.display = 'flex';
      // Visual feedback
      updateHudInfo("Editing", taskToEdit.label);
    } else {
      S.editingId = null;
      title.innerText = "Categorize Time";
      btnDelete.style.display = 'none';
    }
    
    sheet.classList.add('open');
  };

  const closeSheet = () => {
    $('sheetOverlay').classList.remove('open');
    $('draftWedge').style.display = 'none';
    render();
    resetHud();
  };

  const confirmSelection = (type) => {
    if (S.editingId) {
      const t = S.tasks.find(x => x.id === S.editingId);
      t.label = type.l; t.color = type.c; t.icon = type.i;
    } else {
      // Create new
      S.tasks.push({
        id: Date.now(),
        label: type.l,
        color: type.c,
        icon: type.i,
        start: S.draft.start,
        end: S.draft.end
      });
    }
    closeSheet();
  };

  const cancelDraft = () => {
    closeSheet();
  };

  window.App.cancelDraft = cancelDraft; // Expose for overlay click

  // --- HUD UTILS ---
  const formatTime = m => {
    const h = Math.floor(m/60); const mn = m%60;
    return `${String(h).padStart(2,'0')}:${String(mn).padStart(2,'0')}`;
  };

  const updateClock = () => {
    const now = new Date();
    const m = now.getHours()*60 + now.getMinutes();
    const deg = (m/1440)*360;
    $('nowHand').setAttribute('transform', `rotate(${deg} 350 350)`);
    
    // Only update text if not interacting
    if(!$('hub').classList.contains('active') && !$('sheetOverlay').classList.contains('open')) {
      $('hudMain').innerText = formatTime(m);
      $('hudSub').innerText = "";
      $('hudSub').style.color = 'transparent';
    }
  };

  const updateHudInfo = (main, sub) => {
    $('hudMain').innerText = main;
    $('hudSub').innerText = sub;
    $('hudSub').style.color = 'var(--md-sys-color-primary)';
  };

  const resetHud = () => {
    updateClock();
  };

  return { init, cancelDraft };
})();

window.onload = window.App.init;
</script>
</body>
</html>
